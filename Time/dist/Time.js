var __extends=(this&&this.__extends)||function(f,a){for(var e in a){if(a.hasOwnProperty(e)){f[e]=a[e]}}function c(){this.constructor=f}c.prototype=a.prototype;f.prototype=new c()};var Time;(function(j){var i=100;var k=1;var o=8/i;var e;var n;var d;var h;var m=(function(q){__extends(p,q);function p(s,r){q.call(this,s);this.position=[0,0];this.direction=0;this.color=r;this.transformedPolygon=new Geometry.Polygon(Vectorial.Matrix.copy(this.vertices))}p.prototype.render=function(r){r.fillStyle=this.color;r.beginPath();r.moveTo(this.transformedPolygon.vertices[0][0],this.transformedPolygon.vertices[0][1]);for(var s=1;s<this.transformedPolygon.vertices.length;s++){r.lineTo(this.transformedPolygon.vertices[s][0],this.transformedPolygon.vertices[s][1])}r.fill()};p.prototype.preStep=function(){};p.prototype.step=function(){this.preStep();var r=Vectorial.Matrix.multiply(Vectorial.Matrix.rotate(this.direction),Vectorial.Matrix.translate(this.position[0],this.position[1]));Vectorial.Matrix.multiply(this.vertices,r,this.transformedPolygon.vertices)};return p})(Geometry.Polygon);var b=(function(q){__extends(p,q);function p(){q.call(this,[[-20,-20],[20,-20],[20,20],[-20,20],],"red")}p.prototype.preStep=function(){this.position[0]+=this.speed[0];this.position[1]+=this.speed[1]};return p})(m);var c=(function(q){__extends(p,q);function p(){q.call(this,[[-20,-20],[20,-20],[20,20],[-20,20],],"green")}return p})(m);var g=(function(q){__extends(p,q);function p(t,s,u,r){q.call(this,t,s);this.calculatePosition=u;this.calculateDirection=r}p.prototype.preStep=function(){this.position=this.calculatePosition();this.direction=this.calculateDirection()};return p})(m);function a(p){return function(){for(var q=0;q<p.length;q++){if(e>p[q][0]){continue}if(!p[q-1]){return p[q][1]}var r=(e-(p[q-1][0]))/(p[q][0]-p[q-1][0]);return p[q-1][1]+(p[q][1]-p[q-1][1])*r}return p[p.length-1][1]}}var l=(function(p){__extends(q,p);function q(r){var s=this;p.call(this,r);this.player=new b();this.goal=new c();this.addRenderObject({render:function(t){if(!n){return}var v=s.canvas.width/n[0];var u=s.canvas.height/n[1];var y=Math.min(v,u);var x=n[0]*y;var w=n[1]*y;t.fillText(e.toString(),10,40);t.setTransform(y,0,0,y,(s.canvas.width-x)/2,(s.canvas.height-w)/2);t.translate(-d[0],-d[1]);s.obstacles.forEach(function(z){return z.render(t)})}});this.addRenderObject(this.player);this.addStepObject(this.player);this.addRenderObject(this.goal);this.addStepObject(this.goal);this.setLevel(0);this.addStepObject({step:function(){s.obstacles.forEach(function(u){return u.step()});var t=s.obstacles.some(function(u){return u.transformedPolygon.intersectsWith(s.player.transformedPolygon)});if(t){s.stop();s.gameOverCallback();return}k=Math.max(-1,Math.min(1,k+o));e+=k/i;d[0]=Math.max(0,Math.min(h[0]-n[0],s.player.position[0]-n[0]/2))}});r.addEventListener("ontouchend" in document.documentElement?"touchend":"mousedown",function(){return o=-o})}q.prototype.start=function(){p.prototype.start.call(this,i)};q.prototype.setLevel=function(s){d=[0,0];e=0;k=0;o=8/i;var r=q.getLevel(s);n=r.viewSize;h=r.roomSize;this.player.position=r.playerStart;this.player.speed=r.playerSpeed;this.goal.position=r.goalPosition;this.obstacles=r.obstacles};q.getLevel=function(r){var s=r<10?0:r;switch(s){case 0:return{id:r,name:"Intro",viewSize:[500,400],roomSize:[1000,400],playerStart:[20,200],playerSpeed:[30/i,0],goalPosition:[800,200],obstacles:[new g([[0,0],[-200,0],[-200,30],[0,30]],"#FF00BB",function(){return[400,100]},a([[2,0],[4,Math.PI/2]])),new g([[-30,0],[-30,-200],[0,-200],[0,0]],"#FF00BB",function(){return[500,300]},a([[2,0],[4,-Math.PI/2]]))]}}};return q})(Game.GameView);j.GameView=l;function f(){var p=0;var r;var q=new Array();while(r=l.getLevel(p++)){q.push(r)}return q}j.getLevels=f})(Time||(Time={}));